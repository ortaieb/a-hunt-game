# Development Dockerfile with all dependencies and source code
# Use this for running migrations, tests, or development tasks

FROM node:20-alpine AS development

# Install additional tools for development
RUN apk add --no-cache \
    bash \
    curl \
    postgresql-client

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./
COPY tsconfig.json ./

# Install all dependencies (including devDependencies)
RUN npm ci

# Copy all source files and configurations
COPY src ./src
COPY drizzle.config.ts ./
COPY jest.config.js ./
COPY .eslintrc.json ./
COPY tsconfig.test.json ./

# Copy drizzle directory if it exists (for migrations)
# This will be created when you run npm run db:generate
COPY drizzl[e] ./drizzle/ 2>/dev/null || true

# Build the application
RUN npm run build

# Expose the application port
EXPOSE 3000

# Default command for development
CMD ["npm", "run", "dev"]
